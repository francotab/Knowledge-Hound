CREATE TABLE COMMENTS (
ID INT(5) auto_increment,
AUTORE VARCHAR (25) UNIQUE NOT NULL,
OGGETTO INT(5) UNIQUE NOT NULL,
TESTO VARCHAR (100) NOT NULL,
DATA_INVIO DATE NOT NULL,
CONTENUTO VARCHAR (10),
PRIMARY KEY (ID,AUTORE,OGGETTO)
);
CREATE TABLE COMMUNITIES (
ID int(5) auto_increment,
UTENTE VARCHAR (25) NOT NULL,
NOME VARCHAR (20) UNIQUE NOT NULL,
DATA_CREAZIONE DATE NOT NULL,
APERTA BOOLEAN,
TAGS VARCHAR (100),
PRIMARY KEY (ID,UTENTE)
);
CREATE TABLE COMMUNITIES_PENDING_JOININGS(
UTENTE VARCHAR (25) NOT NULL,
COMUNITA INT(5) NOT NULL,
DATA_RICHIESTA DATE NOT NULL,
PRIMARY KEY (UTENTE,COMUNITA)
);
CREATE TABLE CREDENTIALS (
COMUNITA INT(5) NOT NULL,
NOME VARCHAR (15) NOT NULL,
AUTORIZZAZIONE_GEST_SKILL BOOLEAN NOT NULL,
AUTORIZZAZIONE_GEST_OGG BOOLEAN NOT NULL,
AUTORIZZAZIONE_GEST_UT BOOLEAN NOT NULL,
AUTORIZZAZIONE_RIMOZ_COMMENT BOOLEAN NOT NULL,
AUTORIZZAZIONE_GEST_GRUPP BOOLEAN NOT NULL,
CREDENZ_DEFAULT BOOLEAN NOT NULL,
PRIMARY KEY (COMUNITA,NOME)
);
CREATE TABLE MESSAGES (
ID INT(5) auto_increment,
UTENTE VARCHAR (25) NOT NULL,
RICEVENTE VARCHAR (25) NOT NULL,
DATA_INVIO DATE,
LETTURA BOOLEAN,
OGGETTO VARCHAR (20),
TESTO VARCHAR (500),
PRIMARY KEY (ID,UTENTE,RICEVENTE)
);
CREATE TABLE NEWS (
ID INT(5) auto_increment,
COMUNITA INT(5) NOT NULL,
TITOLO VARCHAR (20) NOT NULL,
MESSAGGIO VARCHAR (500) NOT NULL,
TIPO VARCHAR (20) NOT NULL,
DATA_GENERAZIONE DATE NOT NULL,
PRIMARY KEY (ID,COMUNITA)
);

CREATE TABLE OBJECTS (
ID INT(5) auto_increment,
NOME VARCHAR (50) UNIQUE NOT NULL,
DESCRIZIONE VARCHAR (500) NOT NULL,
DATA_CREAZ DATE NOT NULL,
RICEVITORE CHAR (25) UNIQUE NOT NULL,
CREATORE VARCHAR (25) NOT NULL,
NUM_DOWNLOAD INT(7) NOT NULL,
URLS VARCHAR (100) NOT NULL,
TAGS VARCHAR (50),
PRIMARY KEY (ID,RICEVITORE,CREATORE)
);
ALTER TABLE objects add ricevitore int(5) unique not null;

CREATE TABLE OBJECTS_VISIBILIY (
COMUNITA INT(5) NOT NULL,
NOME VARCHAR (15) NOT NULL,
OGGETTO INT(5) NOT NULL,
PRIMARY KEY (COMUNITA,NOME,OGGETTO)
);

CREATE TABLE SKILLS (
ID INT(5) auto_increment,
NOME VARCHAR (50) UNIQUE NOT NULL,
DESCRIZIONE VARCHAR (100) NOT NULL,
DATACREAZIONE DATE NOT NULL,
COMUNITA INT(5) UNIQUE NOT NULL,
TAGS VARCHAR (20),
PRIMARY KEY (ID,COMUNITA)
);

CREATE TABLE SKILLS_REQUISITES (
ID INT(5) auto_increment,
CREDENZIALE_COMM INT(5) NOT NULL,
CREDENZIALE_NOME VARCHAR (15) NOT NULL,
SKILLS INT(5) NOT NULL,
PRIMARY KEY (ID,CREDENZIALE_COMM,CREDENZIALE_NOME,skills)
);

CREATE TABLE SKILLS_VISIBILITY (
ID INT(5) auto_increment,
CREDENZIALE_COMM INT(5) NOT NULL,
CREDENZIALE_NOME VARCHAR (15) NOT NULL,
SKILLS INT(5) NOT NULL,
PRIMARY KEY (ID,CREDENZIALE_COMM,CREDENZIALE_NOME,skills)
);

CREATE TABLE TRACKINGS (
LATITUDINE INT(5) NOT NULL,
LONGITUDINE INT(5) NOT NULL,
DATA_REGISTRAZIONE DATE NOT NULL,
USUARIO VARCHAR(25) NOT NULL,
PRIMARY KEY (USUARIO,DATA_REGISTRAZIONE)
);
CREATE TABLE USERS (
MAIL VARCHAR (25),
NICKNAME VARCHAR (20) UNIQUE NOT NULL,
PASSWORT VARCHAR (20)NOT NULL,
NOME VARCHAR (20) NOT NULL,
COGNOME VARCHAR (20) NOT NULL,
ON_LINE BOOLEAN NOT NULL,
TRACKING BOOLEAN NOT NULL,
DATA_REGISTRAZIONE DATE NOT NULL,
DATA_NASCITA DATE,
DATA_ULTIMA_CONN DATE,
PAESE VARCHAR (10),
CITTA VARCHAR (10),
INDIRIZZO VARCHAR (20),
CIVICO INT(4),
PRIMARY KEY (MAIL)
);
CREATE TABLE USERS_COMMUNITIES (
USUARIO VARCHAR (25) NOT NULL,
COMUNITÀ INT(5) NOT NULL,
NOME VARCHAR (15) NOT NULL,
DATA_PARTECIPAZIONE_COMM DATE NOT NULL,
STATO_COM_PARTECIPAZIONE BOOLEAN NOT NULL,
STATO_COM_DISISCRIZIONE BOOLEAN NOT NULL,
STATO_SKILL_GUADAGNO BOOLEAN NOT NULL,
STATO_SKILL_CREAZIONE BOOLEAN NOT NULL,
STATO_OGG_CREAZIONE BOOLEAN NOT NULL,
STATO_OGG_CANCELLAZIONE BOOLEAN NOT NULL,
STATO_NUOVO_COMMENTO BOOLEAN NOT NULL,
STATO_NUOVA_NEWS BOOLEAN NOT NULL,
PRIMARY KEY (USUARIO,COMUNITÀ,NOME)
);
CREATE TABLE USERS_COMMUNITIES_BLACKLIST (
USUARIO VARCHAR (25) NOT NULL,
COMUNITA INT(5) NOT NULL,
DATA_BLACKLISTING DATE NOT NULL,
DATA_RIMOZIONE DATE NOT NULL,
CAUSA VARCHAR (50),
PRIMARY KEY (USUARIO,COMUNITA)
);
CREATE TABLE USERS_CONNECTIONS (
AMICO1 VARCHAR (25) NOT NULL,
AMICO2 VARCHAR (25) NOT NULL,
DATA_AMICIZIA DATE NOT NULL,
PRIMARY KEY (AMICO1,AMICO2)
);
CREATE TABLE USERS_PENDING_CONNECTIONS (
MITTENTE VARCHAR (25) NOT NULL,
RICEVENTE VARCHAR (25) NOT NULL,
DATA_RICHIESTA DATE NOT NULL,
PRIMARY KEY(MITTENTE,RICEVENTE)
);
CREATE TABLE USERS_SKILLS (
PROPRIETARIO VARCHAR (25) NOT NULL,
SKILL INT(5) NOT NULL,
DATA_ACQUISIZIONE DATE NOT NULL,
NOTE VARCHAR (50),
PRIMARY KEY (PROPRIETARIO,SKILL)
);
CREATE TABLE VALUATIONS (
AUTORE VARCHAR (25) NOT NULL,
OGGETTO INT(5) NOT NULL,
DATA_VALUTAZIONE DATE NOT NULL,
RISULTATO INT(4) NOT NULL,
PRIMARY KEY (AUTORE,OGGETTO)
);

ALTER TABLE COMMENTS
ADD CONSTRAINT FK_COMM_USE FOREIGN KEY (Autore)
REFERENCES USERS (Mail) ;

ALTER TABLE COMMENTS
ADD CONSTRAINT FK_COMM_OBJ FOREIGN KEY (Oggetto)
REFERENCES OBJECTS (ID);

ALTER TABLE COMMUNITIES
ADD CONSTRAINT FK_COM_USE FOREIGN KEY (Utente)
REFERENCES USERS (Mail);

ALTER TABLE COMMUNITIES_PENDING_JOININGS
ADD CONSTRAINT FK_CP_USE FOREIGN KEY (Utente)
REFERENCES USERS (Mail) ;

ALTER TABLE COMMUNITIES_PENDING_JOININGS
ADD CONSTRAINT FK_CPJ_COM FOREIGN KEY (Comunita)
REFERENCES COMMUNITIES (ID);

ALTER TABLE CREDENTIALS
ADD CONSTRAINT FK_CR_COM FOREIGN KEY (Comunita)
REFERENCES COMMUNITIES (ID);

ALTER TABLE MESSAGES
ADD CONSTRAINT FK_MES_USE FOREIGN KEY (Utente)
REFERENCES USERS (Mail);

ALTER TABLE MESSAGES
ADD CONSTRAINT FK_MES_RIC FOREIGN KEY (Ricevente)
REFERENCES USERS (Mail);

ALTER TABLE NEWS
ADD CONSTRAINT FK_NEW_COM FOREIGN KEY (Comunita)
REFERENCES COMMUNITIES (ID);

ALTER TABLE OBJECTS
ADD CONSTRAINT FK_OBJ_COM FOREIGN KEY (Ricevitore)
REFERENCES COMMUNITIES (ID);

ALTER TABLE OBJECTS
ADD CONSTRAINT FK_OBJ_USE FOREIGN KEY (Creatore)
REFERENCES USERS (Mail);

ALTER TABLE OBJECTS_VISIBILIY 
ADD CONSTRAINT FK_OV_CRE FOREIGN KEY (Comunita)
REFERENCES CREDENTIALS (Comunita);

ALTER TABLE OBJECTS_VISIBILIY 
ADD CONSTRAINT FK_OV_nom FOREIGN KEY (Nome)
REFERENCES CREDENTIALS (Nome);

ALTER TABLE OBJECTS_VISIBILIY 
ADD CONSTRAINT FK_OV_OBJ FOREIGN KEY (Oggetto)
REFERENCES OBJECTS (ID);

ALTER TABLE SKILLS
ADD CONSTRAINT FK_SK_COM FOREIGN KEY (Comunita)
REFERENCES COMMUNITIES (ID);

ALTER TABLE SKILLS_REQUISITES
ADD CONSTRAINT FK_SR_CR FOREIGN KEY (Credenziale_Comm)
REFERENCES CREDENTIALS (Comunita);

alter table skills_requisites drop foreign key fk_sr_cr;

ALTER TABLE SKILLS_REQUISITES
ADD CONSTRAINT FK_SR_requ FOREIGN KEY (Credenziale_nome)
REFERENCES CREDENTIALS (nome);

ALTER TABLE SKILLS_REQUISITES
ADD CONSTRAINT FK_SR_SK FOREIGN KEY (Skills)
REFERENCES SKILLS (ID);

ALTER TABLE SKILLS_VISIBILITY
ADD CONSTRAINT FK_SV_CR FOREIGN KEY (Credenziale_Comm)
REFERENCES CREDENTIALS (Comunita);

ALTER TABLE SKILLS_VISIBILITY
ADD CONSTRAINT FK_SV_CR FOREIGN KEY Credenziale_Nome
REFERENCES CREDENTIALS (Nome);

ALTER TABLE SKILLS_VISIBILITY
ADD CONSTRAINT FK_SV_SK FOREIGN KEY (Skills)
REFERENCES SKILLS (ID);

ALTER TABLE TRACKINGS
ADD CONSTRAINT FK_TR_USE FOREIGN KEY (Usuario)
REFERENCES USERS (Mail);

ALTER TABLE USERS_COMMUNITIES
ADD CONSTRAINT FK_UC_USE FOREIGN KEY (Usuario)
REFERENCES USERS (Mail);

ALTER TABLE USERS_COMMUNITIES
ADD CONSTRAINT FK_UC_COM FOREIGN KEY (Comunità)
REFERENCES COMMUNITIES (ID);

ALTER TABLE USERS_COMMUNITIES
ADD CONSTRAINT FK_UC_CR FOREIGN KEY Nome
REFERENCES CREDENTIALS (Nome);

ALTER TABLE USERS_COMMUNITIES_BLACKLIST
ADD CONSTRAINT FK_UCB_USE FOREIGN KEY (Usuario)
REFERENCES USERS (Mail);

ALTER TABLE USERS_COMMUNITIES_BLACKLIST
ADD CONSTRAINT FK_UCB_COM FOREIGN KEY (Comunita)
REFERENCES COMMUNITIES (ID);

ALTER TABLE USERS_CONNECTIONS
ADD CONSTRAINT FK_UCON_USE FOREIGN KEY (Amico1)
REFERENCES USERS (Mail);

ALTER TABLE USERS_CONNECTIONS
ADD CONSTRAINT FK_UCON_USE2 FOREIGN KEY (Amico2)
REFERENCES USERS (Mail);

ALTER TABLE USERS_PENDING_CONNECTIONS
ADD CONSTRAINT FK_UPC_USE FOREIGN KEY (Mittente)
REFERENCES USERS (Mail);

ALTER TABLE USERS_PENDING_CONNECTIONS
ADD CONSTRAINT FK_UPC_USE2 FOREIGN KEY (Ricevente)
REFERENCES USERS (Mail);

ALTER TABLE USERS_SKILLS
ADD CONSTRAINT FK_US_USE FOREIGN KEY (Proprietario)
REFERENCES USERS (Mail);

ALTER TABLE USERS_SKILLS
ADD CONSTRAINT FK_US_SK FOREIGN KEY (Skill)
REFERENCES SKILLS (ID);

ALTER TABLE VALUATIONS
ADD CONSTRAINT FK_VAL_USE FOREIGN KEY (Autore)
REFERENCES USERS (Mail);

ALTER TABLE VALUATIONS
ADD CONSTRAINT FK_VAL_OBJ FOREIGN KEY (Oggetto)
REFERENCES OBJECTS (ID);
